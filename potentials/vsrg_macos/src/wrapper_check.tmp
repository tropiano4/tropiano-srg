        subroutine n3lowidaho(icoup,it,itz,ll,is,jt,nkp,xkp,xwkp) 
        implicit real*8(a-h,o-z)
      real*8::xkp(:),xwkp(:)
      logical icoup
      integer::force
      if(itz.eq.0)force=2
      if(itz.eq.2)force=1
      if(itz.eq.-2)force=3

      if(.not.icoup)then
      		do i=1,nkp
                do ii=1,nkp
                x=xkp(i)
                y=xkp(ii)
                xkkww=sqrt(xwkp(i)*xwkp(ii))*hb2m
                call POTN3LOWLSJ(X,Y,LL,IS,JT,V00,V02,V20,V22,ICOUP,FORCE)    <== *****       
                vnn_kkww(i,ii)=v00*xkkww 
                enddo
                enddo
      else if(icoup)then
      		do i=1,nkp
                do ii=1,nkp
                x=xkp(i)
                y=xkp(ii)
                call POTN3LOWLSJ(X,Y,LL,IS,JT,V00,V02,V20,V22,ICOUP,FORCE)     <== *****        
                xkkww=sqrt(xwkp(i)*xwkp(ii))*hb2m
                vnn_kkww(i,ii)=v00*xkkww 
                vnn_kkww(i+nkp,ii+nkp)=v22*xkkww
                vnn_kkww(i,ii+nkp)=-v02*xkkww 
                vnn_kkww(i+nkp,ii)=-v20*xkkww
                enddo
                enddo
        endif        
        return
        end subroutine n3lowidaho


      SUBROUTINE POTN3LOWLSJ(X,Y,L,IS,JJ,V00,V02,V20,V22,TENSOR,FORCE)
      USE idahon3low
      implicit real*8(a-h,o-z)
C     =================
                          ! 1...PP,  2...NP, 3...NN   !KMD
      INTEGER FORCE
C
      common /crdwrt/ kread,kwrite,kpunch,kda(9)
      COMMON /CPOT/ V( 6),XMEV,YMEV
      COMMON /CSTATE/ J,HEFORM,SING,TRIP,COUP,ENDEP,LABEL
      common /cnn/ inn  

C
C     THE FOLLOWING COMMON BLOCK CONTAINS THE ENERGY-DEPENDENCE
C     OF THE POTENTIAL
C
C
      LOGICAL HEFORM,SING,TRIP,COUP,ENDEP,TENSOR
C
C     THIS HAS BEEN THE END OF THE ARGUMENTS OF THE POTENTIAL SUBROUTINE
C
      PARAMETER(HQC=197.327052)

C*************************************************************
      inn=FORCE     !AN
 
      IF(inn.eq.1) THEN      !PP
        WN=938.27231
      ELSE IF(inn.eq.2) THEN !NP
        WN=939.56563*938.27231/(939.56563+938.27231)*2.0
      ELSE IF(inn.eq.3) THEN !NN
        WN=939.56563
      ELSE                   ! ERROR
        STOP 'POTN3LOLSJ'
      END IF
      HQ2M=HQC**2/WN
C*************************************************************

      HEFORM=.FALSE.
      NAME=LSJ
      SING=.TRUE.
      TRIP=.TRUE.
      COUP=.TRUE.
      ENDEP=.FALSE.
      KREAD=5
      KWRITE=6
      J=JJ

      open (unit=kread,file='n3lowinput.d')
C
      HQC3=HQC**3
      FA=HQC3/HQ2M 
      WNQ=WN*WN
      

 1    XMEV=X*HQC
      YMEV=Y*HQC
      FF=FA*X*Y 
      J=JJ
C
***** CALL OBNN
      CALL  CHINN_low 
C     ---------
C
      IF(J  .GE. 1) GOTO 2
      IF(IS .EQ. 1) GOTO 3
 5    V00 = V(1)*FF
      RETURN
 3    V00 = V(3)*FF
      RETURN
 2    IF(  TENSOR ) GOTO 4
      IF(IS .EQ. 0) GOTO 5
      V00 = V(2)*FF
      RETURN
 4    V00 = V(4)*FF
      V22 = V(3)*FF
      V02 = -V(6)*FF
      V20 = -V(5)*FF
      RETURN
      END SUBROUTINE POTN3LOWLSJ
